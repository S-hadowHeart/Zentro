import{r as s,u as S}from"./vendor-DDy6G2mo.js";var m={exports:{}},p={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _=s,x=Symbol.for("react.element"),w=Symbol.for("react.fragment"),j=Object.prototype.hasOwnProperty,C=_.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,E={key:!0,ref:!0,__self:!0,__source:!0};function y(n,e,a){var t,u={},r=null,i=null;a!==void 0&&(r=""+a),e.key!==void 0&&(r=""+e.key),e.ref!==void 0&&(i=e.ref);for(t in e)j.call(e,t)&&!E.hasOwnProperty(t)&&(u[t]=e[t]);if(n&&n.defaultProps)for(t in e=n.defaultProps,e)u[t]===void 0&&(u[t]=e[t]);return{$$typeof:x,type:n,key:r,ref:i,props:u,_owner:C.current}}p.Fragment=w;p.jsx=y;p.jsxs=y;m.exports=p;var O=m.exports;const k=s.createContext(null),A=()=>{const n=s.useContext(k);if(!n)throw new Error("useAuth must be used within an AuthProvider");return n},I=({children:n})=>{const[e,a]=s.useState(null),[t,u]=s.useState(!0),r=S(),i=s.useCallback(async c=>{if(!c){u(!1);return}u(!0);try{const l=await fetch("/api/auth/me",{headers:{Authorization:`Bearer ${c}`}});if(l.ok){const o=await l.json();a(o.user)}else a(null),localStorage.removeItem("token"),r("/login")}catch(l){console.error("AuthContext fetch user error:",l),a(null),localStorage.removeItem("token"),r("/login")}finally{u(!1)}},[r]),h=s.useCallback(()=>{a(null),localStorage.removeItem("token"),r("/login")},[r]);s.useEffect(()=>{const c=localStorage.getItem("token");i(c)},[i]);const d=s.useCallback(async(c,l)=>{try{const o=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:c,password:l})}),f=await o.json();return o.ok?(localStorage.setItem("token",f.token),a(f.user),r("/tasks"),{success:!0}):{success:!1,error:f.error}}catch(o){return console.error("Error during login:",o),{success:!1,error:"Server error"}}},[r]),g=s.useCallback(async(c,l)=>{try{const o=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:c,password:l})}),f=await o.json();return o.ok?(localStorage.setItem("token",f.token),a(f.user),r("/tasks"),{success:!0}):{success:!1,error:f.error}}catch(o){return console.error("Error during registration:",o),{success:!1,error:"Server error"}}},[r]),v=s.useMemo(()=>({user:e,loading:t,login:d,logout:h,register:g,fetchUser:i}),[e,t,d,h,g,i]);return O.jsx(k.Provider,{value:v,children:n})};export{I as A,O as j,A as u};
//# sourceMappingURL=auth-DJ_g7L93.js.map
