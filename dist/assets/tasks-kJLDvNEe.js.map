{"version":3,"file":"tasks-kJLDvNEe.js","sources":["../../src/contexts/TasksContext.jsx"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect, useCallback, useMemo } from 'react';\nimport { useAuth } from './AuthContext';\n\nconst TasksContext = createContext(null);\n\nexport function useTasks() {\n  const context = useContext(TasksContext);\n  if (!context) {\n    throw new Error('useTasks must be used within a TasksProvider');\n  }\n  return context;\n}\n\nexport function TasksProvider({ children }) {\n  const [tasks, setTasks] = useState([]);\n  const [isLoadingApi, setIsLoadingApi] = useState(false);\n  const { user, loading: authLoading } = useAuth();\n\n  const loading = authLoading || (isLoadingApi && tasks.length === 0);\n\n  const fetchTasks = useCallback(async () => {\n    if (!user) {\n      setTasks([]);\n      return;\n    }\n\n    setIsLoadingApi(true);\n\n    try {\n      const token = localStorage.getItem('token');\n      if (!token) {\n        setTasks([]);\n        setIsLoadingApi(false);\n        return;\n      }\n\n      const response = await fetch('/api/tasks', {\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`\n        }\n      });\n      \n      if (response.ok) {\n        const data = await response.json();\n        setTasks(data);\n      } else {\n        setTasks([]);\n      }\n    } catch (error) {\n      console.error('Error fetching tasks:', error);\n      setTasks([]);\n    } finally {\n      setIsLoadingApi(false);\n    }\n  }, [user]);\n\n  useEffect(() => {\n    if (!authLoading && user) {\n      fetchTasks();\n    }\n  }, [authLoading, user, fetchTasks]);\n\n  const updateTasks = useCallback((updatedTaskData) => {\n    setTasks(updatedTaskData);\n  }, []);\n\n  const addTask = useCallback(async (title) => {\n    try {\n      const token = localStorage.getItem('token');\n      if (!token) return;\n\n      const response = await fetch('/api/tasks', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`\n        },\n        body: JSON.stringify({ title })\n      });\n\n      if (response.ok) {\n        const newTask = await response.json();\n        setTasks(prevTasks => [...prevTasks, newTask]);\n        return newTask;\n      }\n    } catch (error) {\n      console.error('Error adding task:', error);\n    }\n  }, []);\n\n  const incrementPomodorosForTask = useCallback(async (taskId, duration) => {\n    if (!taskId) return;\n    try {\n      const response = await fetch(`/api/tasks/${taskId}/pomodoro`, {\n        method: 'PATCH',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${localStorage.getItem('token')}`\n        },\n        body: JSON.stringify({ duration: duration || 0 })\n      });\n\n      if (response.ok) {\n        const updatedTask = await response.json();\n        setTasks(prevTasks =>\n          prevTasks.map(task =>\n            task._id === updatedTask._id ? updatedTask : task\n          )\n        );\n      } else {\n        const errorData = await response.json();\n        console.error('Failed to increment pomodoro count:', errorData);\n      }\n    } catch (error) {\n      console.error('Error incrementing pomodoros for task:', error);\n    }\n  }, []);\n\n  const toggleTask = useCallback(async (taskId) => {\n    try {\n      const token = localStorage.getItem('token');\n      if (!token) return;\n\n      const response = await fetch(`/api/tasks/${taskId}/toggle`, {\n        method: 'PATCH',\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      });\n\n      if (response.ok) {\n        setTasks(prevTasks =>\n          prevTasks.map(task =>\n            task._id === taskId ? { ...task, completed: !task.completed } : task\n          )\n        );\n      }\n    } catch (error) {\n      console.error('Error toggling task:', error);\n    }\n  }, []);\n\n  const deleteTask = useCallback(async (taskId) => {\n    try {\n      const token = localStorage.getItem('token');\n      if (!token) return;\n\n      const response = await fetch(`/api/tasks/${taskId}`, {\n        method: 'DELETE',\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      });\n\n      if (response.ok) {\n        setTasks(prevTasks => prevTasks.filter(task => task._id !== taskId));\n      }\n    } catch (error) {\n      console.error('Error deleting task:', error);\n    }\n  }, []);\n\n  const value = useMemo(() => ({\n    tasks,\n    loading,\n    fetchTasks,\n    addTask,\n    toggleTask,\n    deleteTask,\n    updateTasks,\n    incrementPomodorosForTask\n  }), [tasks, loading, fetchTasks, addTask, toggleTask, deleteTask, updateTasks, incrementPomodorosForTask]);\n\n  return (\n    <TasksContext.Provider value={value}>\n      {children}\n    </TasksContext.Provider>\n  );\n}\n"],"names":["TasksContext","createContext","useTasks","context","useContext","Error","TasksProvider","children","tasks","setTasks","useState","isLoadingApi","setIsLoadingApi","user","loading","authLoading","useAuth","length","fetchTasks","useCallback","token","localStorage","getItem","response","fetch","headers","ok","data","json","error","useEffect","updateTasks","updatedTaskData","addTask","title","method","body","JSON","stringify","newTask","prevTasks","incrementPomodorosForTask","taskId","duration","updatedTask","map","task","_id","errorData","toggleTask","completed","deleteTask","filter","value","useMemo","_jsx","Provider"],"mappings":"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"}